<!DOCTYPE html>
<html>
<head>
  <title>Classroom</title>

<style>
body {
  margin: 0;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  background: linear-gradient(270deg, #6a11cb, #2575fc);
  background-size: 400% 400%;
  animation: gradientMove 3s ease infinite;
  font-family: Arial, sans-serif;
}

@keyframes gradientMove {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

/* Controls */
.controls {
  margin-top: 80px;
  display: flex;
  gap: 10px;
}

.controls input, .controls select {
  padding: 8px 12px;
  border-radius: 8px;
  border: none;
  font-size: 16px;
}

/* Grid */
.grid-container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 20px;
  width: 90%;
  max-width: 1000px;
  padding: 20px;
}

/* Items */
.grid-item {
  background-color: rgba(255,255,255,0.9);
  border-radius: 10px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.15);
  text-align: center;
  cursor: pointer;
  overflow: hidden;
  opacity: 0;
  transform: translateY(10px);
  animation: fadeIn 0.5s ease forwards;
}

.grid-item:hover {
  transform: scale(1.05);
}

@keyframes fadeIn {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.grid-item img {
  width: 100%;
  height: 150px;
  object-fit: cover;
}

.grid-item h3 {
  margin: 10px;
}

.back-button {
  position: fixed;
  top: 20px;
  left: 20px;
  background: #007bff;
  color: white;
  border: none;
  border-radius: 8px;
  padding: 10px 20px;
  cursor: pointer;
}

/* ===== POPUP ===== */
#popupOverlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  display: flex;
  justify-content: center;
  align-items: center;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.4s ease;
  z-index: 9999;
}
#popupOverlay.show {
  opacity: 1;
  pointer-events: auto;
}
#popupBox {
  background: white;
  border-radius: 14px;
  padding: 30px 35px;
  width: min(500px, 85%);
  text-align: center;
  box-shadow: 0 10px 25px rgba(0,0,0,0.25);
  transform: scale(0.9);
  transition: transform 0.4s ease;
}
#popupOverlay.show #popupBox {
  transform: scale(1);
}
#popupBox button {
  margin-top: 20px;
  padding: 10px 20px;
  border-radius: 8px;
  border: none;
  background: #2575fc;
  color: white;
  cursor: pointer;
}

/* ===== COUNTER BADGE ===== */
#userCounter {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: rgba(0,0,0,0.75);
  color: white;
  padding: 8px 14px;
  border-radius: 20px;
  font-size: 14px;
  z-index: 9998;
}
</style>

<script src="https://cdn.ably.io/lib/ably.min-1.js"></script>

<script>
function brainrot() {
  alert("WARNING: These games may result in loss of braincells!");
  window.location.assign("https://davcode149.github.io/dd-games/0-games/0-brainrot/select.html");
}
</script>
</head>

<body>

<button class="back-button" onclick="window.location.href='index.html'">‚Üê Back</button>

<div class="controls">
  <input type="text" id="searchInput" placeholder="Search games...">
  <select id="sortSelect">
    <option value="az">Sort A‚ÄìZ</option>
    <option value="za">Sort Z‚ÄìA</option>
  </select>
</div>

<div class="grid-container" id="gameGrid"></div>

<!-- POPUP -->
<div id="popupOverlay">
  <div id="popupBox">
    <h2 id="popupTitle"></h2>
    <p id="popupDesc"></p>
    <button onclick="dismissPopup()">Dismiss</button>
  </div>
</div>

<!-- COUNTER -->
<div id="userCounter">üü¢ 0 online</div>

<script>
let allGames = [];

async function loadGames() {
  const res = await fetch("assets/games.json");
  allGames = await res.json();
  renderGames();
}

function renderGames() {
  const grid = document.getElementById("gameGrid");
  const search = document.getElementById("searchInput").value.toLowerCase();
  const sort = document.getElementById("sortSelect").value;

  let filtered = allGames.filter(g =>
    g.name.toLowerCase().includes(search)
  );

  filtered.sort((a, b) => {
    if (sort === "az") return a.name.localeCompare(b.name);
    if (sort === "za") return b.name.localeCompare(a.name);
  });

  grid.innerHTML = "";

  filtered.forEach((game, index) => {
    setTimeout(() => {
      const item = document.createElement("div");
      item.className = "grid-item";

      const img = document.createElement("img");
      img.src = game.image;

      if (game.special === "brainrot") {
        img.onclick = brainrot;
      } else {
        img.onclick = () => window.location.href = game.link;
      }

      const title = document.createElement("h3");
      title.textContent = game.name;

      item.appendChild(img);
      item.appendChild(title);
      grid.appendChild(item);
    }, index * 80);
  });
}

document.getElementById("searchInput").addEventListener("input", renderGames);
document.getElementById("sortSelect").addEventListener("change", renderGames);

loadGames();

/* ===== POPUP CONFIG ===== */
const popupTitleText = "Changelog: Febuary 4, 2026";
const popupDescText = "We've added 4+ new games! Make sure you press Ctrl + Shift + R if you don't see them! Remember to request any games you'd like to see added. We've also got another Dev with plenty of more games they're adding. He's also from USS! Have fun and enjoy DD Games!";
const popupExpireTime = "2026-02-02T23:59:00";

function showPopupIfValid() {
  if (!popupTitleText || !popupDescText) return;
  if (popupExpireTime) {
    if (new Date() > new Date(popupExpireTime)) return;
  }
  popupTitle.textContent = popupTitleText;
  popupDesc.textContent = popupDescText;
  popupOverlay.classList.add("show");
}
function dismissPopup() {
  popupOverlay.classList.remove("show");
}
showPopupIfValid();

/* ===== ABLY COUNTER ===== */
const ably = new Ably.Realtime("f4iV1g.CdzItg:DMBDb8oONqNtkeH6dq25U4DYKAfd-7GQ6uEKXuqUJVw");
const channel = ably.channels.get("site-active-users");

const clientId = "user-" + Math.random().toString(36).slice(2);

ably.connection.once("connected", () => {
  channel.presence.enter({ id: clientId });
});

channel.presence.subscribe(() => {
  channel.presence.get((err, members) => {
    if (!err) {
      document.getElementById("userCounter").textContent =
        "üü¢ " + members.length + " online";
    }
  });
});
</script>

</body>
</html>
