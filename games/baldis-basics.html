<Module>
<html>
  <head>
    <title>Baldi's Basics</title>
    <link rel="icon" type="image/png" href="/favicon.ico" />
    <script type="text/javascript" src="/js/main.js"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Nailington/3kh0-assets@aeb371b7e88542fd5e61eeed9e967a446d84fe1b/baldis-basics/TemplateData/style.css" />
    <script src="https://cdn.jsdelivr.net/gh/Nailington/3kh0-assets@aeb371b7e88542fd5e61eeed9e967a446d84fe1b/baldis-basics/TemplateData/UnityProgress.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/Nailington/3kh0-assets@aeb371b7e88542fd5e61eeed9e967a446d84fe1b/baldis-basics/baldi.js"></script>
    <script>
      var gameInstance = UnityLoader.instantiate("gameContainer", "https://rawcdn.githack.com/Nailington/3kh0-assets/aeb371b7e88542fd5e61eeed9e967a446d84fe1b/baldis-basics/baldi.json", {
        onProgress: UnityProgress,
        Module: {
          onRuntimeInitialized: function () {
            UnityProgress(gameInstance, "complete");
          },
        },
      });
    </script>
  </head>
  <body style="margin: 0;">
    <div class="webgl-content">
      <div id="unityContainer" style="width: 960px; height: 600px; padding: 0px; margin: 0px; border: 0px; position: relative; background: rgb(35, 31, 32);">
        <div id="gameContainer" style="width: 800px; height: 560px; margin: auto;"></div>
      </div>
      <script src="firebase-app.js"></script>
    </div>
    <!-- Include Ably client -->
<script src="https://cdn.jsdelivr.net/npm/ably@1.2.44/browser/static/ably.min.js"></script>

<!-- Active user tracker -->
<script>
  // === ABLY CONFIG ===
  const ABLY_API_KEY = "f4iV1g.CdzItg:DMBDb8oONqNtkeH6dq25U4DYKAfd-7GQ6uEKXuqUJVw"; // <-- replace with your public key
  const CHANNEL_NAME = "site-active-users"; // shared channel name for all pages

  // === CONNECT TO ABLY ===
  const ably = new Ably.Realtime(ABLY_API_KEY);
  const channel = ably.channels.get(CHANNEL_NAME);

  // === JOIN PRESENCE WHEN CONNECTED ===
  ably.connection.once("connected", () => {
    channel.presence.enter("online");
  });

  // === CLEAN EXIT ON PAGE CLOSE ===
  window.addEventListener("beforeunload", () => {
    channel.presence.leave("online");
  });

  // === COUNT FUNCTION ===
  async function updateCount() {
    try {
      const members = await channel.presence.get();
      const counter = document.getElementById("userCount");
      if (counter) {
        counter.textContent = members.length;
      }
    } catch (err) {
      console.error("Error getting presence:", err);
    }
  }

  // === LIVE UPDATES ===
  channel.presence.subscribe("enter", updateCount);
  channel.presence.subscribe("leave", updateCount);
  setInterval(updateCount, 5000);
  updateCount();
</script>
  </body>
</html>
