<!--
EaglercraftX 1.8 by lax1dude and ayunami2000 THIS CODE OPENS Eagletcraft IN A PROXY WITH FULLSCREEN

Eagletcraft compiled by PlanetDoge w/ help from the PlanetGamez team SHARE THIS WITH EVERYONE!

EaglercraftX average RAM usage: 1.2 GB
Eagletcraft average RAM usage: 0.6 GB
-->

<body>
  <!-- ▼ Dropdown menu toggle -->
<div class="menu-container">
  <div class="menu-toggle" onclick="toggleMenu()">▼</div>
  <div class="dropdown-menu" id="dropdownMenu">
    <button onclick="window.location.href='https://davcode149.github.io/dd-games/games.html'">Return</button>
  </div>
</div>

<style>
  /* Position menu at top center */
  .menu-container {
    position: absolute;
    top: 10px;
    right: 10px;
    z-index: 1000;
  }

  /* The arrow toggle */
  .menu-toggle {
    background-color: rgba(255, 255, 255, 0.85);
    border: none;
    border-radius: 50%;
    width: 32px;
    height: 32px;
    text-align: center;
    line-height: 30px;
    font-size: 18px;
    cursor: pointer;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    transition: background-color 0.2s, transform 0.2s;
  }

  .menu-toggle:hover {
    background-color: rgba(240, 240, 240, 0.95);
    transform: scale(1.1);
  }

  /* Dropdown panel */
  .dropdown-menu {
    display: none;
    position: absolute;
    top: 40px;
    right: 0;
    background-color: rgba(255, 255, 255, 0.9);
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    padding: 10px;
    min-width: 120px;
    text-align: center;
    animation: dropdownFade 0.2s ease;
  }

  /* Animation for fade-in */
  @keyframes dropdownFade {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .dropdown-menu button {
    width: 100%;
    padding: 8px 10px;
    border: none;
    border-radius: 6px;
    background-color: #007bff;
    color: white;
    font-size: 14px;
    cursor: pointer;
    transition: background-color 0.3s;
  }

  .dropdown-menu button:hover {
    background-color: #0056b3;
  }
</style>

<script>
  function toggleMenu() {
    var menu = document.getElementById("dropdownMenu");
    menu.style.display = (menu.style.display === "block") ? "none" : "block";
  }

  // Optional: Close menu when clicking outside
  window.addEventListener("click", function(e) {
    if (!e.target.closest(".menu-container")) {
      document.getElementById("dropdownMenu").style.display = "none";
    }
  });
</script>
  <div id="container">
    <iframe id="fr" width="100%" height="100%" frameborder="0" allowfullscreen=""></iframe>
    <button class="play-button" type="button" onclick="PlayTo(this)">CLICK TO PLAY</button>
    <p id="unblocked-text"></p>
  </div>

  <style>
    .play-button {
      padding: 1600px 1080px;
      background: #000;
      color: #fff;
      border: 2px solid #4a148c;
      border-radius: 10px;
      font: 24px Impact;
      cursor: pointer;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 1001;
    }
    .fullscreen-button {
      position: absolute;
      top: 10px;
      right: 10px;
      padding: 10px 20px;
      background: #4a148c;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      z-index: 1002;
    }
    .play-button:hover {
      background: #4a148c;
    }
    body, html {
      margin: 0;
      padding: 0;
      overflow: hidden;
      height: 100%;
    }
  </style>

<script>
  // GameMonetize SDK Entegrasyonu
  window.SDK_OPTIONS = {
    gameId: "jp112o3o4hzgrnc7zaewjkrfk282pul8",
    onEvent: function (a) {
      switch (a.name) {
        case "SDK_GAME_PAUSE":
          console.log("The game has been paused");
          break;
        case "SDK_GAME_START":
          console.log("Eaglercraft is starting...");
          break;
        case "SDK_READY":
          console.log("SDK Ready");
          break;
      }
    }
  };

  const DB_NAME = 'GameCacheDB';
  const STORE_NAME = 'GameFiles';
  const CACHE_DURATION = 90 * 24 * 60 * 60 * 1000; // 3 ay
  const FILE_URL = 'https://cdn.jsdelivr.net/gh/PlanetDogeCodes/EagletcraftX@main/egcfixed.xml';
  const SDK_URL = 'https://cdn.jsdelivr.net/gh/testamalame/sef@main/sedk.js';

  function openDB() {
    return new Promise((resolve, reject) => {
      const request = indexedDB.open(DB_NAME, 1);
      request.onupgradeneeded = (event) => {
        const db = event.target.result;
        db.createObjectStore(STORE_NAME, { keyPath: 'url' });
      };
      request.onsuccess = (event) => resolve(event.target.result);
      request.onerror = (event) => reject(event.target.error);
    });
  }

  async function saveToCache(url, content) {
    const db = await openDB();
    return new Promise((resolve, reject) => {
      const transaction = db.transaction(STORE_NAME, 'readwrite');
      const store = transaction.objectStore(STORE_NAME);
      const request = store.put({ url: url, content: content, timestamp: Date.now() });
      request.onsuccess = () => resolve();
      request.onerror = () => reject(new Error('Cache error'));
    });
  }

  async function getFileFromCache(url) {
    const db = await openDB();
    return new Promise((resolve, reject) => {
      const transaction = db.transaction(STORE_NAME, 'readonly');
      const store = transaction.objectStore(STORE_NAME);
      const request = store.get(url);
      request.onsuccess = async (event) => {
        const data = event.target.result;
        if (data && (Date.now() - data.timestamp) < CACHE_DURATION) {
          resolve(data.content);
        } else {
          try {
            const response = await fetch(url);
            const text = await response.text();
            await saveToCache(url, text);
            resolve(text);
          } catch (err) {
            reject(err);
          }
        }
      };
      request.onerror = () => reject(new Error('DB error'));
    });
  }


  function PlayTo(button) {
    const iframe = document.getElementById("fr");
    getFileFromCache(FILE_URL).then((text) => {
      iframe.contentDocument.open();
      iframe.contentDocument.write(text);
      iframe.contentDocument.close();
      iframe.style.display = "block";
      button.style.display = "none";

      iframe.contentWindow.document.addEventListener('pointerdown', showAdOnClick);
      iframe.contentWindow.document.addEventListener('touchstart', showAdOnClick);
    }).catch((err) => {
      console.error('Error:', err);
    });
  }

  function openFullscreen() {
    getFileFromCache(FILE_URL).then((text) => {
      const newWindow = window.open("", "_blank");
      if (newWindow) {
        newWindow.document.open();
        newWindow.document.write(text);
        newWindow.document.close();

        newWindow.document.addEventListener('pointerdown', showAdOnClick);
        newWindow.document.addEventListener('touchstart', showAdOnClick);
      }
    }).catch((err) => {
      console.error('Error:', err);
    });
  }
</script><div id="imaContainer" style="position: absolute; z-index: 10000; top: 0px; left: 0px; width: 100%; height: 100%; background-color: rgb(0, 0, 0); visibility: hidden; overflow: hidden;">
<script src="https://cdn.jsdelivr.net/npm/ably@1.2.44/browser/static/ably.min.js"></script>
<script>
  // === ABLY CONFIG ===
  const ABLY_API_KEY = "f4iV1g.CdzItg:DMBDb8oONqNtkeH6dq25U4DYKAfd-7GQ6uEKXuqUJVw";
  const CHANNEL_NAME = "site-active-users";

  // === CONNECT TO ABLY WITH RANDOM CLIENT ID ===
  const ably = new Ably.Realtime({
    key: ABLY_API_KEY,
    clientId: 'webUser-' + Math.random().toString(36).substring(2, 9)
  });

  const channel = ably.channels.get(CHANNEL_NAME);

  // === JOIN PRESENCE WHEN CONNECTED ===
  ably.connection.once("connected", () => {
    channel.presence.enter("online");
  });

  // === LEAVE ON PAGE CLOSE ===
  window.addEventListener("beforeunload", () => {
    channel.presence.leave("online");
  });

  // === OPTIONAL COUNTER SNIPPET ===
  function createUserCounter() {
    const counter = document.createElement("div");
    counter.id = "userCounter";
    counter.style.position = "fixed";
    counter.style.bottom = "15px";
    counter.style.right = "15px";
    counter.style.display = "flex";
    counter.style.alignItems = "center";
    counter.style.gap = "8px";
    counter.style.padding = "8px 14px";
    counter.style.background = "linear-gradient(90deg, #2575fc, #6a11cb)";
    counter.style.color = "white";
    counter.style.fontFamily = "Arial, sans-serif";
    counter.style.fontSize = "14px";
    counter.style.borderRadius = "12px";
    counter.style.boxShadow = "0 2px 8px rgba(0,0,0,0.2)";
    counter.style.zIndex = "999";
    counter.style.opacity = "0.9";
    counter.style.transition = "opacity 0.3s ease, transform 0.3s ease";
    counter.innerHTML = `
      <div id="statusDot" style="
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background-color: limegreen;
        box-shadow: 0 0 6px 2px rgba(0,255,0,0.5);
        animation: pulse 1.5s infinite;
      "></div>
      <span id="userText">Connecting...</span>
    `;
    document.body.appendChild(counter);

    // Add pulse animation style
    const style = document.createElement('style');
    style.textContent = `
      @keyframes pulse {
        0%, 100% { transform: scale(1); opacity: 1; }
        50% { transform: scale(1.3); opacity: 0.7; }
      }
      @keyframes countChange {
        0% { transform: scale(1); }
        50% { transform: scale(1.3); }
        100% { transform: scale(1); }
      }
    `;
    document.head.appendChild(style);

    // Optional hover fade
    counter.addEventListener("mouseenter", () => counter.style.opacity = "1");
    counter.addEventListener("mouseleave", () => counter.style.opacity = "0.9");

    return counter;
  }

  // === CREATE COUNTER ONLY WHEN NEEDED ===
  // Comment out this line on pages where you don't want the counter:
  //const counter = createUserCounter();

  // === UPDATE FUNCTION WITH PULSE ON CHANGE ===
  let lastCount = null;
  function updateCount() {
    channel.presence.get((err, members) => {
      if (err) return;
      const count = members.length;

      if (counter) {
        const userText = document.getElementById("userText");
        if (userText) {
          userText.textContent = `${count} user${count !== 1 ? "s" : ""} online`;
          if (lastCount !== null && count !== lastCount) {
            counter.style.animation = "countChange 0.4s ease";
            setTimeout(() => counter.style.animation = "", 400);
          }
        }
      }
      lastCount = count;
    });
  }

  // === PRESENCE SUBSCRIPTIONS ===
  channel.presence.subscribe("enter", updateCount);
  channel.presence.subscribe("leave", updateCount);

  // Initial update
  setTimeout(updateCount, 1000);
</script>
  <!--
HOW IT WORKS:
Eagletcraft was made by distibuting the code of EaglercraftX into many seperate hosted files, then using the page you're on now as a sort of relay for all the seperate files to communicate with one another. This inherently creates latency, so all the files are loaded onto your PC's flash memory to combat this. When the files are loaded to your flash memory, you can turn off wifi and play offline.
-->





